                    }
                    
                    document.addEventListener('mousemove', moveElement);
                    document.addEventListener('mouseup', stopMoving);
                });
            }
            
            // Make both container and dragparent draggable
            makeDraggable(container);
            makeDraggable(dragParent);
            
            // Existing document drag handlers
            documents.forEach(doc => {
                doc.addEventListener('dragstart', handleDragStart);
                doc.addEventListener('dragend', handleDragEnd);
            });
            
            columns.forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
            });
        }

        // Add document form submission
        document.getElementById('addDocumentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const title = document.getElementById('documentTitle').value;
            const content = document.getElementById('documentContent').value;
            
            try {
                const response = await fetch(`/profile/project/${currentColumnId}/document`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, content, columnId: currentColumnId })
                });
                
                if (response.ok) {
                    document.getElementById('addDocumentModal').style.display = 'none';
                    loadDocuments(currentColumnId);
                }
            } catch (error) {
                console.error('Error adding document:', error);
            }
        });

        // Load documents for all projects on page load
        document.addEventListener('DOMContentLoaded', () => {
            const projects = document.querySelectorAll('[data-project-id]');
            projects.forEach(project => {
                loadDocuments(project.dataset.projectId);
            });
        });

        // Get the add document modal
        const addDocumentModal = document.getElementById('addDocumentModal');

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === addDocumentModal) {
                addDocumentModal.style.display = 'none';
                // Clear form fields
                document.getElementById('documentTitle').value = '';
                document.getElementById('documentContent').value = '';
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && addDocumentModal.style.display === 'block') {
                addDocumentModal.style.display = 'none';
                // Clear form fields
                document.getElementById('documentTitle').value = '';
                document.getElementById('documentContent').value = '';
            }
        });

        // Make sure the close button (Ã—) works
        const closeBtn = addDocumentModal.querySelector('.close');
        closeBtn.addEventListener('click', function() {
            addDocumentModal.style.display = 'none';
            // Clear form fields
            document.getElementById('documentTitle').value = '';
            document.getElementById('documentContent').value = '';
        });
      });
    </script>
  </body>
</html> 